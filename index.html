<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>PÃ©nzÃ¼gyeim</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
    if ('Notification' in window && Notification.permission !== 'granted') {
      Notification.requestPermission();
    }
  </script>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      background: url('background.jpg') no-repeat center center top;
      background-attachment: scroll;
      background-size: cover;
      color: #fff;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: rgba(0,0,0,0.6);
      padding: 20px;
      border-radius: 10px;
    }
    input, select, button {
      width: 100%;
      margin: 5px 0;
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
    }
    canvas {
      margin-top: 20px;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      margin: 5px 0;
      padding: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
    }
    table {
      width: 100%;
      margin-top: 20px;
      background: rgba(255,255,255,0.1);
      border-collapse: collapse;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Egyenleg: <span id="balance">0</span> Ft</h1>
  <h2>MegtakarÃ­tÃ¡s: <span id="savings">0</span> Ft</h2>

  <input id="title" placeholder="MegnevezÃ©s">
  <input id="amount" type="number" placeholder="Ã–sszeg">
  <input id="date" type="date">

  <select id="category">
    <option value="Ã‰tel">ğŸ½ï¸ Ã‰tel</option>
    <option value="SzÃ³rakozÃ¡s">ğŸ® SzÃ³rakozÃ¡s</option>
    <option value="KÃ¶zlekedÃ©s">âœˆï¸ KÃ¶zlekedÃ©s</option>
    <option value="RuhÃ¡zat">ğŸ‘• RuhÃ¡zat</option>
    <option value="EgÃ©szsÃ©g">âš•ï¸ EgÃ©szsÃ©g</option>
    <option value="SzÃ¡mla">ğŸ§¾ SzÃ¡mla</option>
    <option value="Gift">ğŸ Gift</option>
    <option value="FizetÃ©s">ğŸ’¸ FizetÃ©s</option>
    <option value="BerakÃ¡s">â•ğŸ’° BerakÃ¡s</option>
    <option value="KivÃ©tel">â–ğŸ’° KivÃ©tel</option>
    <option value="Kp be">ğŸ¦ Kp be</option>
    <option value="Kp ki">ğŸ’¸ğŸ¦ Kp ki</option>
  </select>
  <button onclick="add()">HozzÃ¡adÃ¡s</button>

  <ul id="list"></ul>
  <canvas id="chart1"></canvas>
  <canvas id="chart2"></canvas>
  <table id="summaryTable"></table>
</div>

<script>

let transactions = JSON.parse(localStorage.getItem("transactions") || "[]");
let savings = parseFloat(localStorage.getItem("savings") || "0");

function formatFt(value) {
  return parseFloat(value).toLocaleString('hu-HU') + ' Ft';
}

function notify(text) {
  if (Notification.permission === "granted") {
    new Notification("PÃ©nzÃ¼gyeim", { body: text });
  }
}

function add() {
  const title = document.getElementById("title").value;
  const amount = parseFloat(document.getElementById("amount").value);
  const date = document.getElementById("date").value;
  const category = document.getElementById("category").value;

  if (!title || isNaN(amount) || !date) return;

  transactions.push({ title, amount, date, category });
  localStorage.setItem("transactions", JSON.stringify(transactions));
  notify(`${formatFt(amount)} - ${category}`);
  update();
window.add = add;
}

function remove(index) {
  transactions.splice(index, 1);
  localStorage.setItem("transactions", JSON.stringify(transactions));
  update();
window.add = add;
}

function update() {
  let list = document.getElementById("list");
  let balance = 0;
  let summary = {};
  let savingsDisplay = document.getElementById("savings");
  list.innerHTML = "";

  transactions.forEach((t, i) => {
    const li = document.createElement("li");
    li.innerHTML = `<b>${t.category}</b> - ${formatFt(t.amount)}<br><small>${t.date} | ${t.title}</small><br><button onclick="remove(${i})">TÃ¶rlÃ©s</button>`;
    list.appendChild(li);

    let amt = parseFloat(t.amount);

    if (t.category === "FizetÃ©s" || t.category === "Gift") balance += amt;
    else if (t.category === "SzÃ¡mla" || ["Ã‰tel", "SzÃ³rakozÃ¡s", "KÃ¶zlekedÃ©s", "RuhÃ¡zat", "EgÃ©szsÃ©g"].includes(t.category)) balance -= amt;
    else if (t.category === "BerakÃ¡s") { savings += amt; balance -= amt; }
    else if (t.category === "KivÃ©tel") { savings -= amt; balance += amt; }
    else if (t.category === "Kp be") { savings += amt; }
    else if (t.category === "Kp ki") { savings -= amt; }

    if (!summary[t.category]) summary[t.category] = 0;
    summary[t.category] += amt;
  });

  document.getElementById("balance").innerText = formatFt(balance);
  savingsDisplay.innerText = formatFt(savings);
  localStorage.setItem("savings", savings);
  updateCharts(summary);
  updateSummaryTable(summary);
}

function updateCharts(summary) {
  const ctx1 = document.getElementById("chart1").getContext("2d");
  const ctx2 = document.getElementById("chart2").getContext("2d");
  if (window.chart1) window.chart1.destroy();
  if (window.chart2) window.chart2.destroy();

  const data1 = Object.entries(summary).filter(([k]) =>
    ["FizetÃ©s", "Gift", "SzÃ¡mla", "Ã‰tel", "SzÃ³rakozÃ¡s", "KÃ¶zlekedÃ©s", "RuhÃ¡zat", "EgÃ©szsÃ©g"].includes(k)
  );
  const data2 = Object.entries(summary).filter(([k]) =>
    ["BerakÃ¡s", "KivÃ©tel", "Kp be", "Kp ki"].includes(k)
  );

  window.chart1 = new Chart(ctx1, {
    type: 'bar',
    data: {
      labels: data1.map(d => d[0]),
      datasets: [{
        label: 'KiadÃ¡sok Ã©s bevÃ©telek',
        data: data1.map(d => d[1]),
        backgroundColor: 'rgba(0,123,255,0.5)'
      }]
    }
  });

  window.chart2 = new Chart(ctx2, {
    type: 'bar',
    data: {
      labels: data2.map(d => d[0]),
      datasets: [{
        label: 'MegtakarÃ­tÃ¡s mozgÃ¡sok',
        data: data2.map(d => d[1]),
        backgroundColor: 'rgba(40,200,100,0.6)'
      }]
    }
  });
}

function updateSummaryTable(summary) {
  const table = document.getElementById("summaryTable");
  table.innerHTML = "<tr><th>KategÃ³ria</th><th>Ã–sszeg</th></tr>";
  Object.entries(summary).forEach(([cat, val]) => {
    table.innerHTML += `<tr><td>${cat}</td><td>${formatFt(val)}</td></tr>`;
  });
}

update();
window.add = add;
</script>
</body>
</html>
